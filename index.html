<!DOCTYPE html>
<html lang="en">
<head>
    
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VZT02HF3Z9"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-VZT02HF3Z9');
</script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MinDiary | Daily Mood & Pattern Tracking</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom); }
        
        .btn-score { transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .active-0 { background-color: #dc2626 !important; color: white; transform: scale(1.1); }
        .active-1 { background-color: #ef4444 !important; color: white; transform: scale(1.1); }
        .active-2 { background-color: #f97316 !important; color: white; transform: scale(1.1); }
        .active-3 { background-color: #eab308 !important; color: white; transform: scale(1.1); }
        .active-4 { background-color: #4ade80 !important; color: white; transform: scale(1.1); }
        .active-5 { background-color: #10b981 !important; color: white; transform: scale(1.1); }

        .nav-item-active { color: #2563eb; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade { animation: fadeInUp 0.4s ease-out forwards; }
        .reverse-item { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); }
        .time-btn { transition: all 0.2s ease; }
        .time-btn.active { background-color: #1e293b; color: white; }
        .completed-overlay { background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); }
        .subscale-bar { transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .who5-meter { background: linear-gradient(90deg, #ef4444 0%, #f97316 25%, #eab308 50%, #4ade80 75%, #10b981 100%); }
        .tab-btn { transition: all 0.2s ease; }
        .tab-btn.active { background-color: #3b82f6; color: white; }
        .onboarding-overlay { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(8px); }
        .onboarding-card { background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); }
        .progress-dot { transition: all 0.3s ease; }
        .progress-dot.active { background-color: #3b82f6; transform: scale(1.3); }
        .progress-dot.completed { background-color: #10b981; }
    </style>
</head>
<body class="text-slate-900 overflow-x-hidden">

    <!-- Onboarding -->
    <div id="onboarding-overlay" class="fixed inset-0 z-[100] onboarding-overlay flex items-center justify-center p-6 hidden">
        <div class="onboarding-card w-full max-w-md rounded-3xl p-8 shadow-2xl animate-fade max-h-[90vh] overflow-y-auto">
            <div class="flex justify-center gap-2 mb-6">
                <div id="dot-0" class="progress-dot w-2 h-2 rounded-full bg-slate-300 active"></div>
                <div id="dot-1" class="progress-dot w-2 h-2 rounded-full bg-slate-300"></div>
                <div id="dot-2" class="progress-dot w-2 h-2 rounded-full bg-slate-300"></div>
            </div>
            
            <div id="onboarding-content">
                <div id="onboard-step-0" class="text-center">
                    <div class="text-5xl mb-4">üß†</div>
                    <h2 class="text-2xl font-black mb-3">Welcome to MinDiary</h2>
                    <p class="text-slate-500 mb-4">Track your daily mood and patterns across 8 psychological dimensions.</p>
                    <div class="bg-blue-50 p-4 rounded-2xl text-left">
                        <p class="text-xs font-bold text-blue-700 mb-2">Personal Pattern Tracking</p>
                        <p class="text-sm text-blue-600">Questions are inspired by validated research scales. This is for personal insight, not clinical assessment.</p>
                    </div>
                </div>
                
                <div id="onboard-step-1" class="hidden">
                    <h3 class="text-lg font-black text-center mb-4">8 Dimensions (Research-Inspired)</h3>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div class="bg-blue-50 p-2 rounded-xl"><span class="font-bold text-blue-700">UWES-17</span><br><span class="text-xs text-blue-500">Work Engagement</span></div>
                        <div class="bg-rose-50 p-2 rounded-xl"><span class="font-bold text-rose-700">WHO-5</span><br><span class="text-xs text-rose-500">Well-Being</span></div>
                        <div class="bg-purple-50 p-2 rounded-xl"><span class="font-bold text-purple-700">SCS-R</span><br><span class="text-xs text-purple-500">Social Connection</span></div>
                        <div class="bg-amber-50 p-2 rounded-xl"><span class="font-bold text-amber-700">RSES</span><br><span class="text-xs text-amber-500">Self-Esteem</span></div>
                        <div class="bg-red-50 p-2 rounded-xl"><span class="font-bold text-red-700">PSS-10</span><br><span class="text-xs text-red-500">Stress</span></div>
                        <div class="bg-cyan-50 p-2 rounded-xl"><span class="font-bold text-cyan-700">PANAS</span><br><span class="text-xs text-cyan-500">Affect</span></div>
                        <div class="bg-emerald-50 p-2 rounded-xl"><span class="font-bold text-emerald-700">SWLS</span><br><span class="text-xs text-emerald-500">Life Satisfaction</span></div>
                        <div class="bg-indigo-50 p-2 rounded-xl"><span class="font-bold text-indigo-700">BRS</span><br><span class="text-xs text-indigo-500">Resilience</span></div>
                    </div>
                </div>
                
                <div id="onboard-step-2" class="hidden text-center">
                    <div class="text-5xl mb-4">üìä</div>
                    <h3 class="text-xl font-black mb-3">Track Your Progress</h3>
                    <p class="text-slate-500 mb-4">View your psychological trends over days, months, and years.</p>
                    <div class="bg-emerald-50 p-4 rounded-2xl">
                        <p class="text-sm text-emerald-700">Daily check-ins take about 3-5 minutes.</p>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-between mt-6">
                <button id="onboard-back" onclick="onboardingNav(-1)" class="px-6 py-3 rounded-xl font-bold text-slate-400 hidden">‚Üê Back</button>
                <button id="onboard-next" onclick="onboardingNav(1)" class="ml-auto px-8 py-3 rounded-xl font-bold bg-slate-900 text-white">Next ‚Üí</button>
            </div>
            <button onclick="skipOnboarding()" class="w-full mt-4 text-xs text-slate-400">Skip</button>
        </div>
    </div>

    <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-slate-100 px-6 py-4">
        <div class="max-w-xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-extrabold tracking-tighter uppercase italic">Min<span class="text-blue-600">Diary</span></h1>
            <div id="progress-chip" class="bg-slate-100 text-slate-500 px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest">0 / 24</div>
        </div>
    </header>

    <main class="max-w-xl mx-auto px-4 pt-6 pb-32">
        
        <!-- Completed Today -->
        <section id="completed-view" class="hidden animate-fade">
            <div class="completed-overlay p-8 rounded-3xl shadow-sm border border-emerald-200 text-center">
                <div class="text-6xl mb-4">‚úì</div>
                <h2 class="text-2xl font-black text-emerald-800 mb-2">Today's Assessment Complete!</h2>
                <p class="text-emerald-600 mb-6">Come back tomorrow for new questions.</p>
                <div class="bg-white/60 rounded-2xl p-4 mb-4">
                    <p class="text-xs text-slate-500 uppercase font-bold mb-3">Today's Scores</p>
                    <div id="today-scores" class="grid grid-cols-2 gap-2 text-sm"></div>
                </div>
                <button onclick="showView('stats', document.querySelectorAll('.nav-btn')[1])" class="bg-emerald-600 text-white px-6 py-3 rounded-xl font-bold">View Progress ‚Üí</button>
            </div>
        </section>
        
        <!-- Quiz -->
        <section id="quiz-view" class="animate-fade space-y-4">
            <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100">
                <p class="text-xs text-slate-500 mb-2 font-semibold">Rate how you felt <strong>today</strong>:</p>
                <div class="flex justify-between items-center">
                    <span class="text-[10px] font-bold text-red-500 uppercase">0: Not at all</span>
                    <div class="flex gap-1">
                        <div class="w-2 h-2 rounded-full bg-red-600"></div>
                        <div class="w-2 h-2 rounded-full bg-red-400"></div>
                        <div class="w-2 h-2 rounded-full bg-orange-400"></div>
                        <div class="w-2 h-2 rounded-full bg-yellow-400"></div>
                        <div class="w-2 h-2 rounded-full bg-green-400"></div>
                        <div class="w-2 h-2 rounded-full bg-emerald-500"></div>
                    </div>
                    <span class="text-[10px] font-bold text-emerald-600 uppercase">5: All the time</span>
                </div>
            </div>

            <div id="questions-container" class="space-y-4"></div>
            
            <div class="bg-white p-5 rounded-3xl shadow-sm border border-slate-100">
                <div class="flex items-center gap-2 mb-3">
                    <span class="text-lg">üìù</span>
                    <p class="text-sm font-bold text-slate-700">Daily Note</p>
                    <span class="text-[9px] px-2 py-0.5 rounded-full bg-slate-100 text-slate-400">Optional</span>
                </div>
                <textarea id="daily-note" placeholder="Add context..." class="w-full p-4 rounded-2xl border border-slate-200 text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500" rows="2" maxlength="280"></textarea>
            </div>

            <button onclick="saveAnswers()" class="w-full bg-slate-900 text-white py-5 rounded-2xl font-black text-lg shadow-xl active:scale-95 transition-transform">SUBMIT DAILY ASSESSMENT</button>
        </section>

        <!-- Stats -->
        <section id="stats-view" class="hidden animate-fade space-y-6">
            
            <div class="bg-white p-1.5 rounded-2xl shadow-sm border border-slate-100 flex gap-1">
                <button onclick="setStatsTab('overview')" id="tab-overview" class="tab-btn active flex-1 py-2 rounded-xl font-bold text-sm">Overview</button>
                <button onclick="setStatsTab('dimensions')" id="tab-dimensions" class="tab-btn flex-1 py-2 rounded-xl font-bold text-sm text-slate-500">All Scales</button>
                <button onclick="setStatsTab('history')" id="tab-history" class="tab-btn flex-1 py-2 rounded-xl font-bold text-sm text-slate-500">History</button>
            </div>
            
            <!-- Overview -->
            <div id="stats-overview" class="space-y-6">
                <div class="grid grid-cols-2 gap-3" id="scores-grid"></div>
                
                <!-- Well-being Meter -->
                <div id="who5-panel" class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                    <div class="flex justify-between items-center mb-3">
                        <p class="text-xs font-black text-slate-600 uppercase">Well-Being Score</p>
                        <span id="who5-percentage" class="text-2xl font-black text-rose-600">--</span>
                    </div>
                    <div class="relative h-3 rounded-full overflow-hidden who5-meter mb-2">
                        <div id="who5-marker" class="absolute top-0 w-1 h-full bg-slate-900 rounded transition-all duration-500" style="left: 50%"></div>
                    </div>
                    <div class="flex justify-between text-[9px] text-slate-400 mb-3">
                        <span>Low</span><span>Moderate</span><span>High</span>
                    </div>
                    <div id="who5-interpretation" class="text-xs text-slate-500 bg-slate-50 p-3 rounded-xl"></div>
                </div>
                
                <!-- Time selector -->
                <div class="bg-white p-2 rounded-2xl shadow-sm border border-slate-100 flex gap-2">
                    <button onclick="setTimeView('daily')" id="btn-daily" class="time-btn active flex-1 py-2 rounded-xl font-bold text-sm">Daily</button>
                    <button onclick="setTimeView('monthly')" id="btn-monthly" class="time-btn flex-1 py-2 rounded-xl font-bold text-sm text-slate-500">Monthly</button>
                    <button onclick="setTimeView('yearly')" id="btn-yearly" class="time-btn flex-1 py-2 rounded-xl font-bold text-sm text-slate-500">Yearly</button>
                </div>
                
                <!-- Chart -->
                <div class="bg-white p-4 rounded-3xl shadow-sm border border-slate-100 h-72">
                    <canvas id="mainChart"></canvas>
                </div>
                
                <div class="flex gap-3">
                    <div id="stats-summary" class="flex-1 bg-slate-50 p-4 rounded-2xl">
                        <p class="text-xs text-slate-500 text-center">Complete assessments to see trends</p>
                    </div>
                    <button onclick="exportData()" class="bg-white px-4 py-3 rounded-2xl shadow-sm border border-slate-100 hover:bg-slate-50 flex items-center gap-2">
                        <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                        <span class="text-xs font-bold text-slate-600">CSV</span>
                    </button>
                </div>
            </div>
            
            <!-- Dimensions -->
            <div id="stats-dimensions" class="hidden space-y-4">
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                    <h3 class="font-black text-sm uppercase text-slate-600 mb-4">All 8 Dimensions</h3>
                    <div id="dimensions-bars" class="space-y-4"></div>
                </div>
                
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                    <h3 class="font-black text-sm uppercase text-slate-600 mb-4">UWES Subscales</h3>
                    <div class="space-y-3">
                        <div><div class="flex justify-between mb-1"><span class="text-sm font-medium text-blue-600">Vigor</span><span id="sub-vigor" class="font-bold">--</span></div><div class="h-2 bg-slate-100 rounded-full"><div id="bar-vigor" class="subscale-bar h-full bg-blue-500 rounded-full" style="width:0%"></div></div></div>
                        <div><div class="flex justify-between mb-1"><span class="text-sm font-medium text-indigo-600">Dedication</span><span id="sub-dedication" class="font-bold">--</span></div><div class="h-2 bg-slate-100 rounded-full"><div id="bar-dedication" class="subscale-bar h-full bg-indigo-500 rounded-full" style="width:0%"></div></div></div>
                        <div><div class="flex justify-between mb-1"><span class="text-sm font-medium text-violet-600">Absorption</span><span id="sub-absorption" class="font-bold">--</span></div><div class="h-2 bg-slate-100 rounded-full"><div id="bar-absorption" class="subscale-bar h-full bg-violet-500 rounded-full" style="width:0%"></div></div></div>
                    </div>
                </div>
                
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                    <h3 class="font-black text-sm uppercase text-slate-600 mb-4">PANAS Affect</h3>
                    <div class="flex gap-4">
                        <div class="flex-1 bg-emerald-50 p-4 rounded-xl text-center">
                            <p class="text-xs text-emerald-600 font-bold uppercase">Positive</p>
                            <p id="panas-positive" class="text-2xl font-black text-emerald-700">--</p>
                        </div>
                        <div class="flex-1 bg-red-50 p-4 rounded-xl text-center">
                            <p class="text-xs text-red-600 font-bold uppercase">Negative</p>
                            <p id="panas-negative" class="text-2xl font-black text-red-700">--</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- History -->
            <div id="stats-history" class="hidden space-y-4">
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                    <h3 class="font-black text-sm uppercase text-slate-600 mb-4">Recent Entries</h3>
                    <div id="history-list" class="space-y-3"></div>
                </div>
            </div>
        </section>

        <!-- References -->
        <section id="ref-view" class="hidden animate-fade space-y-6">
            <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 space-y-4">
                <h2 class="font-black text-lg uppercase">About the Questions</h2>
                <p class="text-xs text-slate-500">Questions inspired by 8 research instruments:</p>
                
                <div class="space-y-2 text-xs">
                    <div class="bg-blue-50 p-3 rounded-xl"><span class="font-bold text-blue-600">Work Engagement</span> ‚Äî inspired by UWES-17</div>
                    <div class="bg-rose-50 p-3 rounded-xl"><span class="font-bold text-rose-600">Well-Being</span> ‚Äî inspired by WHO-5</div>
                    <div class="bg-purple-50 p-3 rounded-xl"><span class="font-bold text-purple-600">Social Connection</span> ‚Äî inspired by SCS-R</div>
                    <div class="bg-amber-50 p-3 rounded-xl"><span class="font-bold text-amber-600">Self-Esteem</span> ‚Äî inspired by RSES</div>
                    <div class="bg-red-50 p-3 rounded-xl"><span class="font-bold text-red-600">Stress</span> ‚Äî inspired by PSS-10</div>
                    <div class="bg-cyan-50 p-3 rounded-xl"><span class="font-bold text-cyan-600">Affect</span> ‚Äî inspired by PANAS</div>
                    <div class="bg-emerald-50 p-3 rounded-xl"><span class="font-bold text-emerald-600">Life Satisfaction</span> ‚Äî inspired by SWLS</div>
                    <div class="bg-indigo-50 p-3 rounded-xl"><span class="font-bold text-indigo-600">Resilience</span> ‚Äî inspired by BRS</div>
                </div>
                
                <div class="bg-amber-50 border border-amber-200 p-4 rounded-2xl">
                    <p class="text-xs font-black text-amber-700 uppercase mb-2">‚ö†Ô∏è Important Note</p>
                    <p class="text-[11px] text-amber-600">This app is for <strong>personal pattern tracking only</strong>. Daily scores are sampled from larger scales and are not clinically validated. Do not use for diagnosis or treatment decisions. If you have mental health concerns, please consult a professional.</p>
                </div>
                
                <button onclick="showOnboarding()" class="w-full bg-blue-50 text-blue-600 py-3 rounded-xl font-bold text-sm">üìñ Review Introduction</button>
            </div>
        </section>
    </main>

    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-100 safe-area-bottom">
        <div class="max-w-xl mx-auto flex justify-around py-3 px-4">
            <button onclick="showView('quiz', this)" class="flex flex-col items-center gap-1 nav-btn nav-item-active">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg>
                <span class="text-[10px] font-bold uppercase tracking-tighter">Quiz</span>
            </button>
            <button onclick="showView('stats', this)" class="flex flex-col items-center gap-1 nav-btn text-slate-400">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path></svg>
                <span class="text-[10px] font-bold uppercase tracking-tighter">Stats</span>
            </button>
            <button onclick="showView('ref', this)" class="flex flex-col items-center gap-1 nav-btn text-slate-400">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                <span class="text-[10px] font-bold uppercase tracking-tighter">About</span>
            </button>
        </div>
    </nav>

    <script>
        // ============================================
        // ALL 103 VALIDATED ITEMS
        // ============================================
        const ALL_ITEMS = [
            // UWES-17 (17)
            { id: "UWES1", text: "At my work, I felt bursting with energy", scale: "Work", subscale: "vigor" },
            { id: "UWES2", text: "At my job, I felt strong and vigorous", scale: "Work", subscale: "vigor" },
            { id: "UWES3", text: "When I got up this morning, I felt like going to work", scale: "Work", subscale: "vigor" },
            { id: "UWES4", text: "I could continue working for very long periods at a time", scale: "Work", subscale: "vigor" },
            { id: "UWES5", text: "At my job, I was very resilient, mentally", scale: "Work", subscale: "vigor" },
            { id: "UWES6", text: "At my work I persevered, even when things did not go well", scale: "Work", subscale: "vigor" },
            { id: "UWES7", text: "I found the work that I do full of meaning and purpose", scale: "Work", subscale: "dedication" },
            { id: "UWES8", text: "I was enthusiastic about my job", scale: "Work", subscale: "dedication" },
            { id: "UWES9", text: "My job inspired me", scale: "Work", subscale: "dedication" },
            { id: "UWES10", text: "I was proud of the work that I do", scale: "Work", subscale: "dedication" },
            { id: "UWES11", text: "To me, my job felt challenging", scale: "Work", subscale: "dedication" },
            { id: "UWES12", text: "Time flew when I was working", scale: "Work", subscale: "absorption" },
            { id: "UWES13", text: "When I was working, I forgot everything else around me", scale: "Work", subscale: "absorption" },
            { id: "UWES14", text: "I felt happy when I was working intensely", scale: "Work", subscale: "absorption" },
            { id: "UWES15", text: "I was immersed in my work", scale: "Work", subscale: "absorption" },
            { id: "UWES16", text: "I got carried away when I was working", scale: "Work", subscale: "absorption" },
            { id: "UWES17", text: "It was difficult to detach myself from my job", scale: "Work", subscale: "absorption" },
            
            // WHO-5 (5)
            { id: "WHO1", text: "I felt cheerful and in good spirits", scale: "Wellbeing" },
            { id: "WHO2", text: "I felt calm and relaxed", scale: "Wellbeing" },
            { id: "WHO3", text: "I felt active and vigorous", scale: "Wellbeing" },
            { id: "WHO4", text: "I woke up feeling fresh and rested", scale: "Wellbeing" },
            { id: "WHO5", text: "My daily life was filled with things that interest me", scale: "Wellbeing" },
            
            // SCS-R (20)
            { id: "SCS1", text: "I felt disconnected from the world around me", scale: "Social", reverse: true },
            { id: "SCS2", text: "I felt like an outsider", scale: "Social", reverse: true },
            { id: "SCS3", text: "I felt close to people", scale: "Social" },
            { id: "SCS4", text: "I saw myself as a friendly person", scale: "Social" },
            { id: "SCS5", text: "I felt I belonged in this world", scale: "Social" },
            { id: "SCS6", text: "I felt understood by the people I know", scale: "Social" },
            { id: "SCS7", text: "I caught myself losing sense of connectedness with society", scale: "Social", reverse: true },
            { id: "SCS8", text: "I was able to connect with other people", scale: "Social" },
            { id: "SCS9", text: "I felt distant from people", scale: "Social", reverse: true },
            { id: "SCS10", text: "I felt comfortable in the presence of strangers", scale: "Social" },
            { id: "SCS11", text: "I felt like I didn't belong anywhere", scale: "Social", reverse: true },
            { id: "SCS12", text: "I saw people as friendly and approachable", scale: "Social" },
            { id: "SCS13", text: "I fit in well in new situations", scale: "Social" },
            { id: "SCS14", text: "I felt isolated from others", scale: "Social", reverse: true },
            { id: "SCS15", text: "I was able to relate to my peers", scale: "Social" },
            { id: "SCS16", text: "I had little sense of togetherness with my peers", scale: "Social", reverse: true },
            { id: "SCS17", text: "I felt included by others in activities", scale: "Social" },
            { id: "SCS18", text: "I lacked a sense of belonging", scale: "Social", reverse: true },
            { id: "SCS19", text: "I found myself actively looking for companionship", scale: "Social" },
            { id: "SCS20", text: "I felt that I maintain closeness with others", scale: "Social" },
            
            // RSES (10)
            { id: "RSES1", text: "On the whole, I was satisfied with myself", scale: "Self" },
            { id: "RSES2", text: "At times I thought I am no good at all", scale: "Self", reverse: true },
            { id: "RSES3", text: "I felt that I have a number of good qualities", scale: "Self" },
            { id: "RSES4", text: "I was able to do things as well as most other people", scale: "Self" },
            { id: "RSES5", text: "I felt I did not have much to be proud of", scale: "Self", reverse: true },
            { id: "RSES6", text: "I certainly felt useless at times", scale: "Self", reverse: true },
            { id: "RSES7", text: "I felt that I'm a person of worth", scale: "Self" },
            { id: "RSES8", text: "I wished I could have more respect for myself", scale: "Self", reverse: true },
            { id: "RSES9", text: "All in all, I was inclined to feel that I am a failure", scale: "Self", reverse: true },
            { id: "RSES10", text: "I took a positive attitude toward myself", scale: "Self" },
            
            // PSS-10 (10)
            { id: "PSS1", text: "I was upset because of something that happened unexpectedly", scale: "Stress" },
            { id: "PSS2", text: "I felt unable to control the important things in my life", scale: "Stress" },
            { id: "PSS3", text: "I felt nervous and stressed", scale: "Stress" },
            { id: "PSS4", text: "I felt confident about my ability to handle my personal problems", scale: "Stress", reverse: true },
            { id: "PSS5", text: "I felt that things were going my way", scale: "Stress", reverse: true },
            { id: "PSS6", text: "I found that I could not cope with all the things I had to do", scale: "Stress" },
            { id: "PSS7", text: "I was able to control irritations in my life", scale: "Stress", reverse: true },
            { id: "PSS8", text: "I felt that I was on top of things", scale: "Stress", reverse: true },
            { id: "PSS9", text: "I was angered because of things outside of my control", scale: "Stress" },
            { id: "PSS10", text: "I felt difficulties were piling up so high I could not overcome them", scale: "Stress" },
            
            // PANAS (20)
            { id: "PA1", text: "I felt interested", scale: "PANAS", affect: "positive" },
            { id: "PA2", text: "I felt excited", scale: "PANAS", affect: "positive" },
            { id: "PA3", text: "I felt strong", scale: "PANAS", affect: "positive" },
            { id: "PA4", text: "I felt enthusiastic", scale: "PANAS", affect: "positive" },
            { id: "PA5", text: "I felt proud", scale: "PANAS", affect: "positive" },
            { id: "PA6", text: "I felt alert", scale: "PANAS", affect: "positive" },
            { id: "PA7", text: "I felt inspired", scale: "PANAS", affect: "positive" },
            { id: "PA8", text: "I felt determined", scale: "PANAS", affect: "positive" },
            { id: "PA9", text: "I felt attentive", scale: "PANAS", affect: "positive" },
            { id: "PA10", text: "I felt active", scale: "PANAS", affect: "positive" },
            { id: "NA1", text: "I felt distressed", scale: "PANAS", affect: "negative" },
            { id: "NA2", text: "I felt upset", scale: "PANAS", affect: "negative" },
            { id: "NA3", text: "I felt guilty", scale: "PANAS", affect: "negative" },
            { id: "NA4", text: "I felt scared", scale: "PANAS", affect: "negative" },
            { id: "NA5", text: "I felt hostile", scale: "PANAS", affect: "negative" },
            { id: "NA6", text: "I felt irritable", scale: "PANAS", affect: "negative" },
            { id: "NA7", text: "I felt ashamed", scale: "PANAS", affect: "negative" },
            { id: "NA8", text: "I felt nervous", scale: "PANAS", affect: "negative" },
            { id: "NA9", text: "I felt jittery", scale: "PANAS", affect: "negative" },
            { id: "NA10", text: "I felt afraid", scale: "PANAS", affect: "negative" },
            
            // SWLS (5)
            { id: "SWLS1", text: "In most ways my life is close to my ideal", scale: "LifeSat" },
            { id: "SWLS2", text: "The conditions of my life are excellent", scale: "LifeSat" },
            { id: "SWLS3", text: "I am satisfied with my life", scale: "LifeSat" },
            { id: "SWLS4", text: "So far I have gotten the important things I want in life", scale: "LifeSat" },
            { id: "SWLS5", text: "If I could live my life over, I would change almost nothing", scale: "LifeSat" },
            
            // BRS (6)
            { id: "BRS1", text: "I tend to bounce back quickly after hard times", scale: "Resilience" },
            { id: "BRS2", text: "I have a hard time making it through stressful events", scale: "Resilience", reverse: true },
            { id: "BRS3", text: "It does not take me long to recover from a stressful event", scale: "Resilience" },
            { id: "BRS4", text: "It is hard for me to snap back when something bad happens", scale: "Resilience", reverse: true },
            { id: "BRS5", text: "I usually come through difficult times with little trouble", scale: "Resilience" },
            { id: "BRS6", text: "I tend to take a long time to get over setbacks in my life", scale: "Resilience", reverse: true }
        ];

        // Group items by scale
        const SCALES = {};
        ALL_ITEMS.forEach(item => {
            if (!SCALES[item.scale]) SCALES[item.scale] = [];
            SCALES[item.scale].push(item);
        });

        const ITEMS_PER_SCALE = 3; // 3 items per scale = 24 total
        const STORAGE_KEY = 'mm_daily_v1';
        const ONBOARDING_KEY = 'mm_daily_onboard';
        
        let todayItems = [];
        let todayScores = {};
        let currentTimeView = 'daily';
        let onboardingStep = 0;

        // ============================================
        // HELPERS
        // ============================================
        function getToday() { return new Date().toISOString().split('T')[0]; }
        
        function getHistory() { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); }
        
        function saveHistory(hist) { localStorage.setItem(STORAGE_KEY, JSON.stringify(hist)); }
        
        function hasCompletedToday() {
            return getHistory().some(e => e.date === getToday());
        }
        
        function getTodayEntry() {
            return getHistory().find(e => e.date === getToday());
        }

        // ============================================
        // DAILY SAMPLING
        // ============================================
        function sampleDailyItems() {
            const sampled = [];
            Object.entries(SCALES).forEach(([scale, items]) => {
                const shuffled = [...items].sort(() => Math.random() - 0.5);
                const count = Math.min(ITEMS_PER_SCALE, items.length);
                sampled.push(...shuffled.slice(0, count));
            });
            return sampled.sort(() => Math.random() - 0.5);
        }

        // ============================================
        // ONBOARDING
        // ============================================
        function checkOnboarding() {
            if (!localStorage.getItem(ONBOARDING_KEY)) showOnboarding();
        }
        
        function showOnboarding() {
            onboardingStep = 0;
            document.getElementById('onboarding-overlay').classList.remove('hidden');
            updateOnboardingUI();
        }
        
        function skipOnboarding() {
            localStorage.setItem(ONBOARDING_KEY, 'true');
            document.getElementById('onboarding-overlay').classList.add('hidden');
        }
        
        function onboardingNav(dir) {
            onboardingStep += dir;
            if (onboardingStep < 0) onboardingStep = 0;
            if (onboardingStep > 2) { skipOnboarding(); return; }
            updateOnboardingUI();
        }
        
        function updateOnboardingUI() {
            for (let i = 0; i <= 2; i++) {
                document.getElementById(`onboard-step-${i}`)?.classList.toggle('hidden', i !== onboardingStep);
                const dot = document.getElementById(`dot-${i}`);
                dot.classList.remove('active', 'completed');
                if (i < onboardingStep) dot.classList.add('completed');
                if (i === onboardingStep) dot.classList.add('active');
            }
            document.getElementById('onboard-back').classList.toggle('hidden', onboardingStep === 0);
            document.getElementById('onboard-next').textContent = onboardingStep === 2 ? "Start ‚Üí" : "Next ‚Üí";
        }

        // ============================================
        // QUIZ
        // ============================================
        function initQuiz() {
            checkOnboarding();
            
            if (hasCompletedToday()) {
                showCompletedView();
                return;
            }
            
            todayItems = sampleDailyItems();
            todayScores = {};
            document.getElementById('progress-chip').textContent = `0 / ${todayItems.length}`;
            render();
        }
        
        function showCompletedView() {
            document.getElementById('quiz-view').classList.add('hidden');
            document.getElementById('completed-view').classList.remove('hidden');
            
            const entry = getTodayEntry();
            if (entry) {
                const grid = document.getElementById('today-scores');
                grid.innerHTML = Object.entries(entry.scores).filter(([k]) => !['vigor','dedication','absorption','positive','negative','WHO5_pct'].includes(k)).map(([k, v]) => `
                    <div class="flex justify-between"><span class="text-slate-500">${formatScale(k)}:</span><span class="font-bold">${v.toFixed(1)}</span></div>
                `).join('');
            }
        }
        
        function formatScale(s) {
            const map = { Work: 'Work', Wellbeing: 'Well-being', Social: 'Social', Self: 'Self', Stress: 'Stress', PANAS: 'Affect', LifeSat: 'Life Sat.', Resilience: 'Resilience' };
            return map[s] || s;
        }
        
        function getScaleColor(s) {
            const map = { Work: 'blue', Wellbeing: 'rose', Social: 'purple', Self: 'amber', Stress: 'red', PANAS: 'cyan', LifeSat: 'emerald', Resilience: 'indigo' };
            return map[s] || 'slate';
        }
        
        function getScaleLabel(s) {
            const map = { Work: 'UWES', Wellbeing: 'WHO-5', Social: 'SCS-R', Self: 'RSES', Stress: 'PSS', PANAS: 'PANAS', LifeSat: 'SWLS', Resilience: 'BRS' };
            return map[s] || s;
        }

        function render() {
            const container = document.getElementById('questions-container');
            container.innerHTML = todayItems.map((q, i) => {
                const color = getScaleColor(q.scale);
                return `
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 border-l-8 border-${color}-500 ${q.reverse ? 'reverse-item' : ''}">
                    <div class="flex items-center gap-2 mb-2 flex-wrap">
                        <span class="text-[9px] font-black px-2 py-1 rounded bg-${color}-50 text-${color}-600 uppercase">${getScaleLabel(q.scale)}</span>
                        ${q.reverse ? '<span class="text-[9px] font-black px-2 py-1 rounded bg-amber-100 text-amber-600 uppercase">‚Üª Reverse</span>' : ''}
                        ${q.subscale ? `<span class="text-[8px] px-2 py-0.5 rounded bg-blue-50 text-blue-400 uppercase">${q.subscale}</span>` : ''}
                        ${q.affect ? `<span class="text-[8px] px-2 py-0.5 rounded bg-${q.affect === 'positive' ? 'emerald' : 'red'}-50 text-${q.affect === 'positive' ? 'emerald' : 'red'}-500 uppercase">${q.affect}</span>` : ''}
                    </div>
                    <p class="font-bold text-slate-800 my-4 text-base">${q.text}</p>
                    <div class="flex justify-between gap-1.5">
                        ${[0,1,2,3,4,5].map(n => `<button onclick="pick(${i}, ${n}, this)" class="btn-score flex-1 py-3 rounded-xl border-2 border-slate-100 font-black text-slate-300 bg-slate-50/50 text-sm">${n}</button>`).join('')}
                    </div>
                    <div class="flex justify-between mt-2 text-[9px] text-slate-400"><span>Not at all</span><span>All the time</span></div>
                </div>
            `}).join('');
        }
        
        function pick(idx, n, btn) {
            const item = todayItems[idx];
            todayScores[item.id] = { raw: n, reverse: item.reverse || false, scale: item.scale, subscale: item.subscale, affect: item.affect };
            
            btn.parentElement.querySelectorAll('button').forEach(b => {
                b.className = b.className.replace(/active-\d/g, '');
                b.classList.remove('text-white');
                b.classList.add('text-slate-300');
            });
            btn.classList.add(`active-${n}`, 'text-white');
            btn.classList.remove('text-slate-300');
            document.getElementById('progress-chip').textContent = `${Object.keys(todayScores).length} / ${todayItems.length}`;
        }
        
        function saveAnswers() {
            if (Object.keys(todayScores).length < todayItems.length) {
                return alert(`Please answer all ${todayItems.length} questions!`);
            }
            
            const scores = calculateScores();
            const note = document.getElementById('daily-note').value.trim();
            
            const hist = getHistory();
            hist.push({
                date: getToday(),
                scores: scores,
                note: note
            });
            saveHistory(hist);
            
            showView('stats', document.querySelectorAll('.nav-btn')[1]);
        }
        
        function calculateScores() {
            const byScale = {};
            const subscales = { vigor: [], dedication: [], absorption: [], positive: [], negative: [] };
            
            Object.values(todayScores).forEach(s => {
                const adjusted = s.reverse ? (5 - s.raw) : s.raw;
                if (!byScale[s.scale]) byScale[s.scale] = [];
                byScale[s.scale].push(adjusted);
                
                if (s.subscale) subscales[s.subscale].push(s.raw);
                if (s.affect) subscales[s.affect].push(s.raw);
            });
            
            const result = {};
            Object.entries(byScale).forEach(([scale, vals]) => {
                result[scale] = vals.reduce((a, b) => a + b, 0) / vals.length;
            });
            
            Object.entries(subscales).forEach(([sub, vals]) => {
                if (vals.length) result[sub] = vals.reduce((a, b) => a + b, 0) / vals.length;
            });
            
            // WHO-5 percentage (if we have wellbeing items)
            if (result.Wellbeing !== undefined) {
                result.WHO5_pct = result.Wellbeing * 20; // Scale 0-5 to 0-100
            }
            
            return result;
        }

        // ============================================
        // STATS
        // ============================================
        function setStatsTab(tab) {
            ['overview', 'dimensions', 'history'].forEach(t => {
                document.getElementById(`tab-${t}`).classList.toggle('active', t === tab);
                document.getElementById(`tab-${t}`).classList.toggle('text-slate-500', t !== tab);
                document.getElementById(`stats-${t}`).classList.toggle('hidden', t !== tab);
            });
            if (tab === 'dimensions') renderDimensions();
            if (tab === 'history') renderHistory();
        }
        
        function setTimeView(view) {
            currentTimeView = view;
            ['daily', 'monthly', 'yearly'].forEach(v => {
                document.getElementById(`btn-${v}`).classList.toggle('active', v === view);
                document.getElementById(`btn-${v}`).classList.toggle('text-slate-500', v !== view);
            });
            renderChart();
        }
        
        function getLatestScores() {
            const hist = getHistory();
            return hist.length ? hist[hist.length - 1].scores : null;
        }
        
        function renderStats() {
            renderScoresGrid();
            renderWHO5();
            renderChart();
        }
        
        function renderScoresGrid() {
            const scores = getLatestScores();
            const grid = document.getElementById('scores-grid');
            
            const dims = [
                { key: 'Work', label: 'Work', color: 'blue' },
                { key: 'Wellbeing', label: 'Well-being', color: 'rose' },
                { key: 'Social', label: 'Social', color: 'purple' },
                { key: 'Self', label: 'Self-Esteem', color: 'amber' },
                { key: 'Stress', label: 'Stress', color: 'red' },
                { key: 'LifeSat', label: 'Life Sat.', color: 'emerald' },
                { key: 'Resilience', label: 'Resilience', color: 'indigo' },
                { key: 'PANAS', label: 'Affect', color: 'cyan' }
            ];
            
            grid.innerHTML = dims.map(d => `
                <div class="bg-white p-4 rounded-2xl border-l-4 border-${d.color}-500 shadow-sm">
                    <p class="text-[10px] font-black text-slate-400 uppercase">${d.label}</p>
                    <p class="text-2xl font-black">${scores && scores[d.key] !== undefined ? scores[d.key].toFixed(1) : '--'}</p>
                </div>
            `).join('');
        }
        
        function renderWHO5() {
            const scores = getLatestScores();
            if (!scores || scores.WHO5_pct === undefined) {
                document.getElementById('who5-percentage').textContent = '--';
                document.getElementById('who5-interpretation').textContent = 'Complete an assessment to see your well-being score.';
                return;
            }
            
            const pct = scores.WHO5_pct;
            document.getElementById('who5-percentage').textContent = `${pct.toFixed(0)}%`;
            document.getElementById('who5-marker').style.left = `${pct}%`;
            
            let interp, cls;
            if (pct <= 33) { interp = 'Lower than usual ‚Äî consider what might be affecting your mood.'; cls = 'text-amber-600 bg-amber-50'; }
            else if (pct <= 66) { interp = 'Moderate well-being today.'; cls = 'text-slate-600 bg-slate-50'; }
            else { interp = 'Feeling good today!'; cls = 'text-emerald-600 bg-emerald-50'; }
            
            document.getElementById('who5-interpretation').innerHTML = interp;
            document.getElementById('who5-interpretation').className = `text-xs p-3 rounded-xl ${cls}`;
        }
        
        function renderDimensions() {
            const scores = getLatestScores();
            const container = document.getElementById('dimensions-bars');
            
            const dims = [
                { key: 'Social', label: 'Social Connectedness', color: 'purple' },
                { key: 'Work', label: 'Work Engagement', color: 'blue' },
                { key: 'Wellbeing', label: 'Well-Being', color: 'rose' },
                { key: 'Self', label: 'Self-Esteem', color: 'amber' },
                { key: 'Stress', label: 'Perceived Stress', color: 'red' },
                { key: 'LifeSat', label: 'Life Satisfaction', color: 'emerald' },
                { key: 'Resilience', label: 'Resilience', color: 'indigo' },
                { key: 'PANAS', label: 'Affect', color: 'cyan' }
            ];
            
            container.innerHTML = dims.map(d => {
                const val = scores ? scores[d.key] : null;
                return `
                    <div>
                        <div class="flex justify-between mb-1">
                            <span class="text-sm font-medium text-${d.color}-600">${d.label}</span>
                            <span class="font-bold">${val !== null && val !== undefined ? val.toFixed(1) : '--'}</span>
                        </div>
                        <div class="h-2 bg-slate-100 rounded-full">
                            <div class="subscale-bar h-full bg-${d.color}-500 rounded-full" style="width: ${val ? (val/5)*100 : 0}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Subscales
            ['vigor', 'dedication', 'absorption'].forEach(s => {
                const val = scores ? scores[s] : null;
                document.getElementById(`sub-${s}`).textContent = val !== null && val !== undefined ? val.toFixed(1) : '--';
                document.getElementById(`bar-${s}`).style.width = val ? `${(val/5)*100}%` : '0%';
            });
            
            document.getElementById('panas-positive').textContent = scores?.positive?.toFixed(1) || '--';
            document.getElementById('panas-negative').textContent = scores?.negative?.toFixed(1) || '--';
        }
        
        function renderHistory() {
            const hist = getHistory();
            const container = document.getElementById('history-list');
            
            if (!hist.length) {
                container.innerHTML = '<p class="text-sm text-slate-400 text-center py-4">No entries yet</p>';
                return;
            }
            
            container.innerHTML = hist.slice().reverse().slice(0, 10).map(entry => `
                <div class="bg-slate-50 p-4 rounded-xl">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-bold">${new Date(entry.date).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}</span>
                    </div>
                    <div class="grid grid-cols-4 gap-1 text-xs">
                        ${Object.entries(entry.scores).filter(([k]) => !['vigor','dedication','absorption','positive','negative','WHO5_pct'].includes(k)).map(([k, v]) => `
                            <div><span class="text-slate-400">${k.slice(0,4)}:</span> <span class="font-bold">${v.toFixed(1)}</span></div>
                        `).join('')}
                    </div>
                    ${entry.note ? `<p class="text-xs text-slate-500 mt-2 italic">"${entry.note}"</p>` : ''}
                </div>
            `).join('');
        }
        
        function aggregateData(hist, period) {
            if (period === 'daily') return hist.slice(-30);
            
            const grouped = {};
            hist.forEach(entry => {
                const d = new Date(entry.date);
                let key = period === 'monthly' 
                    ? `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`
                    : `${d.getFullYear()}`;
                
                if (!grouped[key]) grouped[key] = { entries: [], scores: {} };
                grouped[key].entries.push(entry);
            });
            
            return Object.entries(grouped).sort(([a],[b]) => a.localeCompare(b)).map(([key, data]) => {
                const avgScores = {};
                const allKeys = new Set();
                data.entries.forEach(e => Object.keys(e.scores).forEach(k => allKeys.add(k)));
                
                allKeys.forEach(k => {
                    const vals = data.entries.map(e => e.scores[k]).filter(v => v !== undefined);
                    if (vals.length) avgScores[k] = vals.reduce((a,b) => a+b, 0) / vals.length;
                });
                
                return { date: key, scores: avgScores, count: data.entries.length };
            });
        }
        
        function formatLabel(dateStr, period) {
            if (period === 'daily') return new Date(dateStr).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            if (period === 'monthly') {
                const [y, m] = dateStr.split('-');
                return new Date(y, m-1).toLocaleDateString('en-US', { month: 'short', year: '2-digit' });
            }
            return dateStr;
        }
        
        function renderChart() {
            const hist = getHistory();
            document.getElementById('stats-summary').innerHTML = `<p class="text-xs text-slate-500 text-center">${hist.length} total entries</p>`;
            
            if (!hist.length) return;
            
            const data = aggregateData(hist, currentTimeView);
            const dims = ['Work', 'Wellbeing', 'Social', 'Self', 'Stress', 'LifeSat', 'Resilience'];
            const colors = { Work: '#3b82f6', Wellbeing: '#f43f5e', Social: '#a855f7', Self: '#f59e0b', Stress: '#ef4444', LifeSat: '#10b981', Resilience: '#6366f1' };
            
            const ctx = document.getElementById('mainChart').getContext('2d');
            if (window.mainChartInstance) window.mainChartInstance.destroy();
            
            window.mainChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => formatLabel(d.date, currentTimeView)),
                    datasets: dims.filter(d => data.some(entry => entry.scores[d] !== undefined)).map(d => ({
                        label: d,
                        data: data.map(entry => entry.scores[d]),
                        borderColor: colors[d],
                        backgroundColor: colors[d] + '20',
                        tension: 0.4,
                        fill: false,
                        spanGaps: true
                    }))
                },
                options: {
                    maintainAspectRatio: false,
                    interaction: { intersect: false, mode: 'index' },
                    plugins: { legend: { display: true, position: 'bottom', labels: { boxWidth: 8, font: { size: 9 } } } },
                    scales: { y: { min: 0, max: 5 }, x: { ticks: { maxRotation: 45, font: { size: 9 } } } }
                }
            });
        }
        
        function exportData() {
            const hist = getHistory();
            if (!hist.length) return alert('No data yet!');
            
            const allKeys = new Set();
            hist.forEach(e => Object.keys(e.scores).forEach(k => allKeys.add(k)));
            const keys = Array.from(allKeys);
            
            const headers = ['Date', ...keys, 'Note'];
            const rows = hist.map(e => [e.date, ...keys.map(k => e.scores[k]?.toFixed(2) || ''), `"${(e.note||'').replace(/"/g,'""')}"`]);
            
            const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `mindiary-${getToday()}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ============================================
        // NAVIGATION
        // ============================================
        function showView(v, btn) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            
            if (v === 'quiz') {
                if (hasCompletedToday()) {
                    document.getElementById('completed-view').classList.remove('hidden');
                } else {
                    document.getElementById('quiz-view').classList.remove('hidden');
                }
            } else {
                document.getElementById(`${v}-view`).classList.remove('hidden');
            }
            
            document.querySelectorAll('.nav-btn').forEach(b => {
                b.classList.add('text-slate-400');
                b.classList.remove('nav-item-active');
            });
            btn.classList.add('nav-item-active');
            btn.classList.remove('text-slate-400');
            
            if (v === 'stats') { renderStats(); setStatsTab('overview'); }
            window.scrollTo(0, 0);
        }
        
        // Init
        initQuiz();
    </script>
</body>
</html>
